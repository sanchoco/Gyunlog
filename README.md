# Gyunlog
>ë¡œê·¸ì¸í•˜ì—¬ ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”! ğŸ˜€   



## êµ¬í˜„ í™”ë©´
![ezgif-3-fcb76ddd2d2e](https://user-images.githubusercontent.com/58046372/113247144-5bd10580-92f5-11eb-93e2-26127610c366.gif)

## ì‚¬ìš©í•œ ê²ƒ
Javascript, Node.js, mongoDB, JWT
   
   
## ì£¼ìš” ê¸°ëŠ¥
- **ë©”ì¸ í˜ì´ì§€(ê¸€ ëª©ë¡)**: ëˆ„êµ¬ë‚˜ ê¸€ ëª©ë¡ì„ í™•ì¸í•˜ê³  í´ë¦­í•˜ì—¬ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
- **íšŒì›ê°€ì…**: ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„ì„ í™•ì¸í•˜ê³  íšŒì›ê°€ì…ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ**: ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸ í•  ìˆ˜ ìˆê³  ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‚˜ì˜¬ ìˆ˜ ìˆì–´ìš”.
- **ê¸€ ì‘ì„±, ìˆ˜ì •, ì‚­ì œ**: ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ê¸€ì„ ì‘ì„±í•˜ì—¬ ê²Œì‹œí•  ìˆ˜ ìˆê³  ìì‹ ì˜ ê¸€ë§Œ ìˆ˜ì • ë° ì‚­ì œê°€ ê°€ëŠ¥í•´ìš”.
- **ëŒ“ê¸€ ì‘ì„±, ìˆ˜ì •, ì‚­ì œ**: ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆê³  ìì‹ ì˜ ëŒ“ê¸€ë§Œ ìˆ˜ì • ë° ì‚­ì œê°€ ê°€ëŠ¥í•´ìš”.



## í˜ì´ì§€ë³„ ê¸°ëŠ¥ ìƒì„¸ ì„¤ëª…

<details>
    <summary>ë©”ì¸ í˜ì´ì§€</summary>

- ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ë¡œê·¸ì¸ ë²„íŠ¼ í˜¹ì€ ê¸€ì“°ê¸° ë²„íŠ¼ì´ ë³´ì´ê²Œ ë˜ë©° ì ‘ì† ì¤‘ì¸ ì‚¬ìš©ì ë‹‰ë„¤ì„ì„ í‘œì‹œí•©ë‹ˆë‹¤.
- ê¸€ ëª©ë¡ì€ ìµœì‹ ìˆœìœ¼ë¡œ í‘œì‹œë˜ë©° ì œëª©, ì‘ì„±ì, ì‘ì„± ì¼ìë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
- ìì„¸íˆ ë³´ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í•´ë‹¹ ê¸€ì˜ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.

</details>

<details>
    <summary>ë¡œê·¸ì¸ í˜ì´ì§€</summary>

- ì‚¬ìš©ìëŠ” ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸ì„ ìš”ì²­í•©ë‹ˆë‹¤.
- ì„œë²„ëŠ” DBì™€ í•´ë‹¹ ì‚¬ìš©ìê°€ ì¡´ì¬í•œë‹¤ë©´ í† í°ì„ ë°œê¸‰í•˜ê³  ë¡œê·¸ì¸ ìš”ì²­ì„ ìŠ¹ì¸í•©ë‹ˆë‹¤.
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
- ë§Œì•½ ê°•ì œë¡œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì— ì ‘ì†í•œë‹¤ë©´ ë©”ì¸ í˜ì´ì§€ë¡œ ëŒë ¤ë³´ëƒ…ë‹ˆë‹¤.
```javascript
user = await User.findOne({ id }).exec();

if (user) {
   await bcrypt.compare(password, user.password, (err, same) => {
      // ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜ ì—¬ë¶€
      if (same) {
         // ë¹„ë°€ë²ˆí˜¸ê°€ ì •ìƒì ìœ¼ë¡œ ì…ë ¥ëœ ê²½ìš°
         const key = require('../secret_key'); // ì‹œí¬ë¦¿í‚¤ ê°€ì ¸ì˜¤ê¸°
         const token = jwt.sign({ userId: user._id }, key); // _idë¡œ ê³ ìœ  í† í° ìƒì„±
         res.json({ msg: 'success', token });
      } else {
         res.json({ msg: 'fail' });
      }
   });
} else {
   res.json({ msg: 'fail' });
}
```
</details>


<details>
    <summary>íšŒì›ê°€ì…</summary>

- ì•„ì´ë””ëŠ” 3ì ì´ìƒ ì˜ë¬¸ ,ìˆ«ì, _ ë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ê³  íŒ¨ìŠ¤ì›Œë“œëŠ” ì•„ì´ë””ê°€ í¬í•¨ë˜ì§€ ì•ŠëŠ” 4ì ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.
- ë‹‰ë„¤ì„ì€ ê³µë°±ì„ ì œì™¸í•œ 2ì~10ì ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.
- ê°€ì…í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ë©´ ê¸°ì¡´ ì‚¬ìš©ìì˜ ì•„ì´ë””, ë‹‰ë„¤ì„ê³¼ ì¤‘ë³µë˜ëŠ”ì§€ ì²´í¬í•©ë‹ˆë‹¤.
- ëª¨ë“  ì¡°ê±´ì„ ì¶©ì¡±í•œë‹¤ë©´ ê°€ì…ì •ë³´ì™€ íŒ¨ìŠ¤ì›Œë“œ(bcrypt ëª¨ë“ˆì„ í™œìš©í•˜ì—¬ salt í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì•”í˜¸í™”ëœ ê°’)ë¥¼ DBì— ì €ì¥í•©ë‹ˆë‹¤.
- íšŒì›ê°€ì…ì´ ì„±ê³µì ì´ë¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
- ë§Œì•½ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê°•ì œë¡œ í˜ì´ì§€ì— ì ‘ì†í•œë‹¤ë©´ ë©”ì¸ í˜ì´ì§€ë¡œ ëŒë ¤ë³´ëƒ…ë‹ˆë‹¤.

```javascript
await User.create({ // ê²€ì¦ í›„ ìœ ì € ìƒì„±
   id: sanitizeHtml(id),
   password: bcrypt.hashSync(password, 10), // ì•”í˜¸í™” ì €ì¥
   nickname: sanitizeHtml(nickname)
});
```
</details>

<details>
    <summary>ìƒì„¸ í˜ì´ì§€</summary>
	
- ëˆ„êµ¬ë“ ì§€ ê¸€ì˜ ì œëª©, ì‘ì„±ì, ì‘ì„±ì¼, ëŒ“ê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í•´ë‹¹ ê¸€ì˜ ì‘ì„±ìë§Œ ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼ì´ ë³´ì´ë©° í•´ë‹¹ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ëŒ“ê¸€ ì‘ì„±ì€ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì—ê²Œë§Œ ë³´ì´ë©° ëŒ“ê¸€ì„ ì‘ì„±í•˜ì—¬ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ëŒ“ê¸€ì€ ìµœì‹ ìˆœìœ¼ë¡œ ë³´ì´ë©° ìì‹ ì´ ì‘ì„±í•œ ëŒ“ê¸€ë§Œ ìˆ˜ì • ë° ì‚­ì œë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê²Œì‹œê¸€ ì‚­ì œ ì‹œ ëŒ“ê¸€ë“¤ì´ ëª¨ë‘ ì§€ì›Œì§‘ë‹ˆë‹¤.

```javascript
router.get('/:id', async (req, res) => {
	const id = req.params.id;
	const post = await Post.findOne({ postId: id }).select('postId title nickname content date');

	let user;
	try {
		const { token } = req.headers;
		const { userId } = jwt.verify(token, key);
		user = await User.findOne({ _id: userId }, { nickname: true });
	} catch (err) {}
	let permission = 0; // í”„ë¡ íŠ¸ ìˆ˜ì •,ì‚­ì œ ë²„íŠ¼ì„ í‘œì‹œí•˜ê¸° ìœ„í•œ ë³€ìˆ˜
	if (user && user['nickname'] == post['nickname']) permission = 1;

	const data = {
		postId: id,
		title: sanitizeHtml(post['title']),
		nickname: sanitizeHtml(post['nickname']),
		content: sanitizeHtml(post['content']),
		date: moment(post['date']).format('MM/DD HH:mm:ss'),
		permission: permission
	};
	res.json(data);
});
```
</details>

<details>
    <summary>ê¸€ì“°ê¸°</summary>
	
- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ í•´ë‹¹ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì œëª©ê³¼ ë‚´ìš©ì„ ì‘ì„±í•˜ì—¬ ê¸€ì“°ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê²Œì‹œê¸€ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë§Œì•½ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ê°•ì œë¡œ í˜ì´ì§€ì— ì ‘ì†í•œë‹¤ë©´ ë©”ì¸ í˜ì´ì§€ë¡œ ëŒë ¤ë³´ëƒ…ë‹ˆë‹¤.

```javascript
const title = sanitizeHtml(data['title']);
const content = sanitizeHtml(data['content']);
if (!(title && content)) {
   res.json({ msg: 'empty' });
   return;
} else {
   const lasted = await Post.findOne().sort({ postId: -1 });
   let index = 1;
   if (lasted) {
      index = lasted['postId'] + 1;
   }
   await Post.create({
      postId: index,
      title: title,
      nickname: user.nickname,
      content: content,
      date: Date.now()
   });
   res.json({ msg: 'success' });
}
```

</details>

<details>
    <summary>ê³µí†µ ê¸°ëŠ¥</summary>
	
- ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì€ ëª¨ë‘ í† í°ì„ í™•ì¸í•˜ì—¬ ì •ìƒì ì¸ ì‚¬ìš©ìì¸ì§€ ì²´í¬í•©ë‹ˆë‹¤. (ë¯¸ë“¤ì›¨ì–´)
- ì™¸ë¶€ë¡œ ë³´ì´ëŠ” ëª¨ë“  ì •ë³´ëŠ” XSS ê³µê²©ì„ ëŒ€ë¹„í•´ sanitize-html ëª¨ë“ˆì„ í™œìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë³´ì—¬ì¤ë‹ˆë‹¤.

```javascript
module.exports = (req, res, next) => { // ì ‘ì† ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
	const { token } = req.headers;
	if (!token) {
		res.status(401).send({ message: 'ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' });
		return
	}
	try {
		jwt.verify(token, key); // í† í° ê²€ì¦
		next();
	} catch (err) {
		res.status(401).send({ message: 'ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' }); //ì ‘ê·¼ ì œí•œ
		return
	}
}
```
</details>

## API ëª©ë¡
<details>
    <summary>ìì„¸íˆ</summary>

|                |     ê¸°ëŠ¥     | Method |        URL         |                 request                 |                           response                           |
| :------------: | :----------: | :----: | :----------------: | :-------------------------------------: | :----------------------------------------------------------: |
|  ë©”ì¸ í˜ì´ì§€   |  í™”ë©´ í‘œì‹œ   |  GET   |         /          |                                         |                          index.html                          |
|                |  ê¸€ ë¦¬ìŠ¤íŠ¸   |  GET   |       /list        |                                         |             { postId, title, nickname, date }...             |
|                |  ì ‘ì† ì •ë³´   |  GET   |       /user        |                                         |                           nickname                           |
|     ë¡œê·¸ì¸     |  í™”ë©´ í‘œì‹œ   |  GET   |       /login       |                                         |                          login.html                          |
|                | ì‚¬ìš©ì ì ‘ì†  |  POST  |       /login       |            { id, password }             |                 success \|\| empty \|\| fail                 |
|    íšŒì›ê°€ì…    |  í™”ë©´ í‘œì‹œ   |  GET   |     /register      |                                         |                        register.html                         |
|                |  ë“±ë¡ ìš”ì²­   |  POST  |     /register      | { id, password, password_re, nickname } | success \|\| empty \|\| wrong_id \|\| wrong_nickname \|\| wrong_password \|\| already_id \|\| already_nickname \|\| diff_password |
| ê¸€ ì‘ì„± í˜ì´ì§€ |  í™”ë©´ í‘œì‹œ   |  GET   |        /new        |                                         |                           new.html                           |
|                |   ê¸€ ì‘ì„±    |  POST  |        /new        |            { title, content}            |                 success \|\| empty \|\| fail                 |
|  ìƒì„¸ í˜ì´ì§€   |  í™”ë©´ í‘œì‹œ   |  GET   |      /:postId      |                                         |                         detail.html                          |
|                | ê¸€ ìƒì„¸ ì •ë³´ |  GET   |   /list/:postId    |                                         |               {title, nickname, content, date}               |
|                |   ê¸€ ìˆ˜ì •    |  PUT   |   /list/:postId    |           { title, content  }           |                 success \|\| empty \|\| fail                 |
|                |   ê¸€ ì‚­ì œ    | DELETE |   /list/:postId    |                                         |                      success \|\| fail                       |
|                |  ëŒ“ê¸€ ëª©ë¡   |  GET   |  /comment/:postId  |                                         |                 {nickname, comment, date}...                 |
|                |  ëŒ“ê¸€ ì‘ì„±   |  POST  |  /comment/:postId  |               { comment }               |                 success \|\| empty \|\| fail                 |
|                |  ëŒ“ê¸€ ìˆ˜ì •   |  PUT   | comment/:commentId |         { commentId, comment }          |                 success \|\| empty \|\| fail                 |
|                |  ëŒ“ê¸€ ì‚­ì œ   | DELETE | comment/:commentId |                                         |                      success \|\| fail                       |

</details>

